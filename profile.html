<!DOCTYPE html>
<html lang="ka">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>მართვის პანელი - GeorgiaTravel</title>
    <link rel="icon" type="image/webp" href="images/gh_logo.webp">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Georgian:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- FullCalendar -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <!-- Tippy.js -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light.css" />
    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
        body {
            font-family: 'Noto Sans Georgian', sans-serif;
        }

        /* Hide scrollbar for gallery */
        .hide-scroll::-webkit-scrollbar {
            display: none;
        }

        .hide-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">

    <!-- Navbar -->
    <nav class="fixed top-0 left-0 w-full z-40 bg-white shadow-md py-3 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
            <a href="index.html">
                <img src="images/gh_logo.webp" alt="GeorgiaTravel"
                    class="h-10 max-h-[40px] w-auto drop-shadow-md object-contain cursor-pointer transition-transform hover:scale-105 active:scale-95">
            </a>
            <div class="flex items-center space-x-3">
                <a href="pricing.html"
                    class="hidden md:flex items-center bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all animate-flag">
                    <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    ფასების ნახვა
                </a>
                <button onclick="openAddModal()"
                    class="bg-amber-500 hover:bg-amber-600 text-white font-bold p-2.5 rounded-full transition-all shadow-md hover:shadow-lg flex items-center justify-center transform hover:-translate-y-0.5"
                    title="დამატება">
                    <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                </button>
                <div id="navAuthBtnContainer">
                    <button id="navAuthBtn" onclick="openAuthModal('register')"
                        class="bg-[#2d78b1] hover:bg-[#236a9e] text-white font-bold py-2 px-6 rounded-full transition-all shadow-sm">
                        შესვლა
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <div class="h-20"></div> <!-- Spacer for fixed navbar -->

    <!-- Navigation Tabs -->
    <div class="max-w-7xl mx-auto px-4 mb-8">
        <div class="flex space-x-6 border-b border-gray-200">
            <button id="tabProp"
                class="pb-3 text-lg font-bold text-amber-600 border-b-2 border-amber-500 transition-colors cursor-default">
                ჩემი განცხადებები
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 pb-20">

        <!-- PROPERTIES TAB -->
        <div id="propertiesView">
            <!-- Header -->
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
                <div></div>
                <div class="flex-shrink-0">
                    <a href="add-property.html"
                        class="inline-flex items-center justify-center bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-amber-200 transition-all transform hover:-translate-y-0.5">
                        <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        ახალი განცხადება
                    </a>
                </div>
            </div>

            <!-- Status & Grid -->
            <div id="statusMessage" class="text-center py-20 text-gray-400 animate-pulse">
                იტვირთება...
            </div>

            <div id="listings-container" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Cards will be injected here -->
            </div>
        </div>
    </main>

    <script>
        const CONFIG = {
            SUPABASE_URL: 'https://akmbyvovhubccznrzotv.supabase.co',
            SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFrbWJ5dm92aHViY2N6bnJ6b3R2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NTgwMTAsImV4cCI6MjA4MjMzNDAxMH0.oHLvbx5_4hYATF-hQkJvp0oxZ6ljUfGKYP-Mf7_CVtM',
            DEFAULT_IMAGE: "https://images.unsplash.com/photo-1566073771259-6a8506099945?w=500&q=80"
        };

        const State = {
            supabase: supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY),
            user: null
        };

        let myProperties = [];

        async function init() {
            // Auth Listener
            State.supabase.auth.onAuthStateChange((event, session) => {
                State.user = session ? session.user : null;
                updateNavigation();
                if (event === 'SIGNED_OUT' || !session) window.location.href = 'index.html';
            });

            // Init Session Check
            const { data: { session } } = await State.supabase.auth.getSession();
            if (!session) {
                window.location.href = 'index.html';
                return;
            }
            State.user = session.user;
            updateNavigation();
            loadUserListings();
        }

        // Helper for Image URLs
        function getFullImageUrl(path) {
            if (!path) return CONFIG.DEFAULT_IMAGE;
            if (path.startsWith('http') || path.startsWith('blob:')) return path;
            const { data } = State.supabase.storage.from('images').getPublicUrl(path);
            return data.publicUrl;
        }

        async function loadUserListings() {
            try {
                // CHANGED: From 'guesthouse ge' to 'guesthouse_ge'
                const { data, error } = await State.supabase
                    .from('guesthouse_ge')
                    .select('*')
                    .eq('user_id', State.user.id)
                    .order('created_at', { ascending: false });

                if (error) throw error;
                myProperties = data || [];

                const container = document.getElementById('listings-container');
                const status = document.getElementById('statusMessage');

                if (status) status.classList.add('hidden');
                if (container) {
                    container.classList.remove('hidden');
                    if (myProperties.length === 0) {
                        container.innerHTML = `
                            <div class="col-span-full flex flex-col items-center justify-center py-20 bg-white rounded-3xl border-2 border-dashed border-gray-200">
                                <h3 class="text-xl font-bold text-gray-900 mb-2">თქვენ ჯერ არ გაქვთ განცხადებები</h3>
                                <p class="text-gray-500 mb-6 max-w-sm text-center">დაამატეთ ახალი განცხადება მთავარი გვერდიდან.</p>
                                <a href="add-property.html" class="px-6 py-2 bg-amber-500 text-white rounded-xl font-bold">დამატება</a>
                            </div>`;
                    } else {
                        container.innerHTML = myProperties.map(createCardHTML).join('');
                    }
                }
            } catch (err) {
                console.error("Error loading listings:", err);
                const status = document.getElementById('statusMessage');
                if (status) status.textContent = "შეცდომა განცხადებების ჩატვირთვისას.";
            }
        }

        function calculateCurrentPrice(p) {
            const currentMonthIndex = new Date().getMonth();
            let display = "შეთანხმებით";

            // Check for new price_display field first
            if (p.price_display && p.price_display > 0) {
                return `₾${p.price_display}`;
            }

            let seasonal = [];
            if (p.seasonal_prices) {
                if (Array.isArray(p.seasonal_prices)) seasonal = p.seasonal_prices;
                else if (typeof p.seasonal_prices === 'string') {
                    try { seasonal = JSON.parse(p.seasonal_prices); } catch (e) { }
                }
            }

            if (seasonal.length > 0) {
                const monthPrices = seasonal.map(s => s.prices[currentMonthIndex]).filter(price => price > 0);
                if (monthPrices.length > 0) {
                    const minP = Math.min(...monthPrices);
                    const maxP = Math.max(...monthPrices);
                    display = minP === maxP ? `₾${minP}` : `₾${minP} - ₾${maxP}`;
                }
            } else if (p.price) {
                display = `₾${p.price}`;
            }
            return display;
        }

        // ... existing createCardHTML function ...

        // ... existing updateAuthUI function ...

        // ... existing handleLogout function ...

        window.deleteProperty = async function (id) {
            const result = await Swal.fire({
                title: 'ნამდვილად გსურთ წაშლა?',
                text: "ეს ქმედება შეუქცევადია!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'დიახ, წაშლა!',
                cancelButtonText: 'გაუქმება'
            });

            if (!result.isConfirmed) return;

            try {
                // CHANGED: From 'guesthouse ge' to 'guesthouse_ge'
                const { error } = await State.supabase.from('guesthouse_ge').delete().eq('id', id);
                if (error) throw error;

                await Swal.fire(
                    'წაიშალა!',
                    'თქვენი განცხადება წარმატებით წაიშალა.',
                    'success'
                );
                window.location.reload();
            } catch (e) {
                console.error("Delete error:", e);
                Swal.fire({
                    icon: 'error',
                    title: 'შეცდომა',
                    text: 'ვერ მოხერხდა წაშლა: ' + e.message
                });
            }
        }

        function createCardHTML(prop) {
            // 0. Image Logic
            let displayImage = CONFIG.DEFAULT_IMAGE;
            let rawImages = [];
            if (prop.images) {
                if (Array.isArray(prop.images)) rawImages = prop.images;
                else if (typeof prop.images === 'string') {
                    try {
                        if (prop.images.startsWith('{')) rawImages = prop.images.slice(1, -1).split(',');
                        else rawImages = JSON.parse(prop.images);
                    } catch (e) {
                        if (prop.images.trim()) rawImages = [prop.images];
                    }
                }
            }
            if (rawImages.length === 0 && prop.image_url) rawImages = [prop.image_url];

            if (rawImages.length > 0 && rawImages[0]) {
                let img = rawImages[0].trim();
                // Clean quotes from postgres array string
                if ((img.startsWith('"') && img.endsWith('"')) || (img.startsWith("'") && img.endsWith("'"))) {
                    img = img.slice(1, -1);
                }
                displayImage = getFullImageUrl(img);
            }

            // Price Calculation
            const currentPriceDisplay = calculateCurrentPrice(prop);

            // Badge & Glow Logic
            let badge = '';
            // CHANGED: super-vip -> super_vip
            if (prop.tier === 'super_vip') badge = '<span class="bg-gradient-to-r from-yellow-400 to-amber-500 text-white text-[10px] font-bold px-2 py-1 rounded shadow-sm uppercase tracking-wider ml-2 border border-white/20">SUPER VIP</span>';
            else if (prop.tier === 'vip-plus') badge = '<span class="bg-indigo-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow-sm uppercase tracking-wider ml-2">VIP +</span>';
            else if (prop.tier === 'vip') badge = '<span class="bg-amber-500 text-white text-[10px] font-bold px-2 py-1 rounded shadow-sm uppercase tracking-wider ml-2">VIP</span>';

            let glowClass = '';
            if (prop.tier === 'vip-plus') glowClass = 'ring-4 ring-indigo-100 border-2 border-indigo-200 shadow-lg';
            else if (prop.tier === 'vip') glowClass = 'border border-amber-200 shadow-md';

            // Status Check (Pending/Draft)
            let statusBadge = '';
            let setupButton = '';
            if (prop.status === 'pending') {
                statusBadge = '<span class="bg-gray-100 text-gray-500 text-[10px] font-bold px-2 py-1 rounded border border-gray-200 uppercase tracking-wider ml-2">Draft</span>';
                setupButton = `
                    <a href="select-plan.html?id=${prop.id}" class="w-full flex items-center justify-center px-4 py-2.5 bg-emerald-500 text-white rounded-lg text-sm font-bold shadow-lg shadow-emerald-100 hover:bg-emerald-600 transition-all mb-3" onclick="event.stopPropagation();">
                        <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                        დასრულება და გამოქვეყნება
                    </a>`;
            }

            // Actions HTML (Edit / Delete)
            const actionsHTML = `
                <div class="grid grid-cols-2 gap-3 mt-4 z-20 relative">
                    <a href="add-property.html?id=${prop.id}" class="flex items-center justify-center px-4 py-2 border border-gray-200 rounded-lg text-sm font-bold text-gray-600 hover:bg-amber-50 hover:text-amber-600 hover:border-amber-200 transition-colors bg-white/50 backdrop-blur-sm" onclick="event.stopPropagation();">
                        <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                        რედაქტირება
                    </a>
                    <button onclick="event.stopPropagation(); deleteProperty('${prop.id}')" class="flex items-center justify-center px-4 py-2 border border-red-100 bg-red-50/50 backdrop-blur-sm rounded-lg text-sm font-bold text-red-600 hover:bg-red-100 hover:border-red-200 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                        წაშლა
                    </button>
                </div>`;

            // Super VIP Layout
            // CHANGED: super-vip -> super_vip
            if (prop.tier === 'super_vip') {
                return `
            <div class="col-span-1 sm:col-span-2 lg:col-span-3 bg-white rounded-2xl shadow-xl overflow-hidden cursor-default fade-in group border-4 border-yellow-400 transform hover:scale-[1.01] transition-all duration-300 relative">
                <div class="absolute inset-0 bg-yellow-400/5 z-0 pointer-events-none"></div>
                <div class="flex flex-col md:flex-row h-full md:h-80 relative z-10">
                    <div class="md:w-2/3 h-64 md:h-full relative overflow-hidden">
                        <img src="${displayImage}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
                        <div class="absolute top-4 left-4 flex items-center">
                            <span class="bg-white/90 backdrop-blur-md px-3 py-1 rounded-lg text-sm font-bold text-gray-800 shadow-sm uppercase">${prop.type}</span>
                            ${badge}
                            ${statusBadge}
                        </div>
                    </div>
                    <div class="md:w-1/3 p-8 flex flex-col justify-center bg-gradient-to-br from-white to-amber-50">
                        <h3 class="font-extrabold text-3xl mb-2 text-gray-900 group-hover:text-amber-600 transition-colors truncate" title="${prop.name}">${prop.name}</h3>
                        <p class="text-gray-500 mb-6 flex items-center">
                            <svg class="w-5 h-5 mr-1 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                            <span class="truncate">${prop.location}</span>
                        </p>
                        <div class="text-amber-600 font-bold text-3xl mt-auto mb-4">${currentPriceDisplay}</div>
                        ${setupButton}
                        ${actionsHTML}
                    </div>
                </div>
            </div>`;
            }

            // Standard Layout
            return `
        <div class="bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden cursor-default fade-in group ${glowClass} flex flex-col h-full">
            <div class="relative h-56 overflow-hidden">
                <img src="${displayImage}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500">
                <div class="absolute top-3 left-3 flex items-center">
                    <span class="bg-white/90 backdrop-blur-sm px-2 py-1 rounded-md text-xs font-bold text-gray-800 shadow-sm uppercase tracking-wide">${prop.type}</span>
                    ${badge}
                    ${statusBadge}
                </div>
                <div class="absolute bottom-3 right-3 bg-gray-900/80 backdrop-blur-sm text-white px-2 py-1 rounded-md text-sm font-bold flex items-center shadow-sm">
                    <span class="text-yellow-400 mr-1">★</span> ${prop.rating || 5.0}
                </div>
            </div>
            <div class="p-5 flex-1 flex flex-col">
                <h3 class="font-bold text-lg text-gray-900 leading-tight mb-1 truncate group-hover:text-amber-600 transition-colors">${prop.name}</h3>
                <p class="text-sm text-gray-500 flex items-center mb-3">
                    <svg class="w-4 h-4 mr-1 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    ${prop.location}
                </p>
                <div class="flex justify-between items-center pt-3 border-t border-gray-100 mt-auto">
                   <div class="text-amber-600 font-bold text-xl">${currentPriceDisplay}</div>
                </div>
                ${setupButton}
                ${actionsHTML}
            </div>
        </div>`;
        }

        async function updateNavigation() {
            const container = document.getElementById('navAuthBtnContainer');
            if (!container) return;

            if (State.user) {
                const name = State.user.user_metadata.full_name || State.user.email;
                const avatar = State.user.user_metadata.avatar_url || 'https://www.gravatar.com/avatar/?d=mp';

                // Fetch Profile Tier
                let tier = 'Free';
                try {
                    const { data, error } = await State.supabase
                        .from('profiles')
                        .select('subscription_tier')
                        .eq('id', State.user.id)
                        .single();

                    if (data && data.subscription_tier) {
                        tier = data.subscription_tier;
                    }
                } catch (e) {
                    console.error("Error fetching profile tier:", e);
                }

                let tierDisplay = `<span class="font-bold text-gray-700 ml-1 tracking-tight">${tier}</span>`;
                if (tier === 'Free') {
                    tierDisplay += `<a href="pricing.html" class="ml-2 text-[10px] bg-amber-500 text-white px-2 py-0.5 rounded-full hover:bg-amber-600 transition-colors uppercase font-bold tracking-wide shadow-sm">Upgrade</a>`;
                }

                container.innerHTML = `
                    <div class="relative ml-2">
                         <button id="profileTrigger" onclick="toggleProfileDropdown(event)" class="flex items-center space-x-2 focus:outline-none bg-white hover:bg-gray-50 rounded-full pl-1 pr-3 py-1 transition-colors border border-gray-200 shadow-sm">
                            <img src="${avatar}" class="w-8 h-8 rounded-full border border-gray-200 object-cover">
                            <span class="hidden sm:inline text-sm font-bold text-gray-700 max-w-[100px] truncate">${name.split(' ')[0]}</span>
                            <svg class="w-4 h-4 text-gray-500 opacity-80" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                        </button>
                        <div id="profileDropdown" class="absolute right-0 mt-3 w-64 bg-white rounded-2xl shadow-2xl border border-gray-100 py-2 hidden z-50 animate-fade-in-down">
                             <div class="px-5 py-3 border-b border-gray-100 mb-1">
                                <p class="text-xs text-gray-400 font-medium uppercase tracking-wider">ანგარიში</p>
                                <p class="text-sm font-bold text-gray-900 truncate mt-0.5">${name}</p>
                                <div class="text-xs text-gray-500 mt-1 flex items-center">
                                    პაკეტი: ${tierDisplay}
                                </div>
                        </div>
                        <div class="py-1">
                            <a href="profile.html" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-amber-50 hover:text-amber-600 transition-colors">
                                <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                                ჩემი განცხადებები
                            </a>
                            <a href="bookings.html" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                                <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                                ჯავშნები / კალენდარი
                            </a>
                        </div>
                        <div class="border-t border-gray-100 py-1">
                            <button onclick="handleLogout()" class="flex w-full items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">
                                <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/></svg>
                                გასვლა
                            </button>
                        </div>
                    </div>
                </div>`;
            } else {
                container.innerHTML = `
                    <button id="navAuthBtn" onclick="openAuthModal('register')"
                        class="bg-[#2d78b1] hover:bg-[#236a9e] text-white font-bold py-2 px-6 rounded-full transition-all shadow-sm">
                        შესვლა
                    </button>`;
            }
        }

        window.toggleProfileDropdown = function (e) {
            e.stopPropagation();
            const d = document.getElementById('profileDropdown');
            if (d) d.classList.toggle('hidden');
        };

        document.addEventListener('click', (e) => {
            const d = document.getElementById('profileDropdown');
            const t = document.getElementById('profileTrigger');
            if (d && !d.classList.contains('hidden') && !d.contains(e.target) && (!t || !t.contains(e.target))) {
                d.classList.add('hidden');
            }
        });
        window.handleLogout = async function () {
            await State.supabase.auth.signOut();
            window.location.href = 'index.html';
        };

        window.openAddModal = () => {
            if (State.user) {
                window.location.href = 'add-property.html';
            } else {
                window.location.href = 'index.html?auth=register';
            }
        };

        window.openAuthModal = (type) => {
            window.location.href = `index.html?auth=${type}`;
        };



        // Start
        init();
    </script>
</body>

</html>